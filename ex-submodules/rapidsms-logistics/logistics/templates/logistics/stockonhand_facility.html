{% extends "logistics/reports_base.html" %}
{% load logistics_extras %}
{% load i18n %}
{% block javascripts %}
{{ block.super }}
{% if raw_data %}
		<script type='text/javascript' src='https://www.google.com/jsapi'></script>
	    <script type='text/javascript'>
	      google.load('visualization', '1', {'packages':['annotatedtimeline']});
	      google.setOnLoadCallback(drawChart);
	      function drawChart() {
	        {{ raw_data|safe }}
	        var chart = new google.visualization.AnnotatedTimeLine(document.getElementById('chart_div'));
	        chart.draw(raw_data, {legendPosition:"newRow", displayRangeSelector:false});
	      }
	    </script>
{% endif %}
{% endblock %}

{% block content %}
    <div class="module">
        {% include "logistics/partials/accordion_nav.html" %}
        <div id="main">
        <h2 id="report-title">Stock for {{ facility.name }}</h2>
        {% if stockonhands %}
            {% if excel_export %}
				<div class="toolbar">
				    <a href="{% url export_stock facility.code %}" class="add">Export to Excel</a>
				</div>
		    {% endif %}
                <div id="report-content">
                
                {% if raw_data %}
                <div id="chart_div" style="width:500px; height:350px; margin: 20px 0px;"></div>
                {% endif %}
                
                <br />
                <div id="table">
                <table class="stock">
                    <thead><tr>
                        <th>{% trans "Commodity" %}</th>
                        <th class="stock_col">{% trans "Months Until Stockout" %}</th>
                        <th class="stock_col">{% trans "Current Stock" %}</th>
                        <th class="stock_col">{% trans "Monthly Consumption" %}</th>
                        <th class="stock_col">{% trans "Emergency Level" %}</th>
                        <th class="stock_col">{% trans "Reorder Level" %}</th>
                        <th class="stock_col">{% trans "Maximum Level" %}</th>
                    </tr></thead>
                    <tbody>
                    {% for stockonhand in stockonhands %}
                        <tr>
                        <td>{{ stockonhand.product.name }}</td>
                        {% highlight_months stockonhand MEDIA_URL %}
                        <td>{{ stockonhand.quantity|default_if_none:"unknown" }}</td>
                        <td {% ifequal stockonhand.monthly_consumption None %}
                                class="big_error"
                            {% endifequal %}>
                            {{ stockonhand.monthly_consumption|default_if_none:"not set" }}
                        </td>
                        <td>{{ stockonhand.emergency_reorder_level|default_if_none:"unknown" }}</td>
                        <td>{{ stockonhand.reorder_level|default_if_none:"unknown" }}</td>
                        <td>{{ stockonhand.maximum_level|default_if_none:"unknown" }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                </div>
                <br/>
                {% ifequal request.user.get_profile.facility facility %}
                <a href="{% url input_stock facility.code %}">INPUT STOCK for {{ facility.name }}</a>
                {% else %}
	                {% if request.user.is_superuser %}
	                <a href="{% url input_stock facility.code %}">INPUT STOCK for {{ facility.name }}</a>
	                {% endif %}
                {% endifequal %}
                {% if last_reported %}
                    <p>The last report received was on {{ last_reported|date:"M d, h:m A" }}.</p>
                {%  endif %}
	            </div>
            {% else %}<p></p>
                <div class="error">
                    <p>{{ facility.name }} has not been configured with the appropriate stock or submitted any stock on hand reports yet.</p>
                    <p>Please contact the system administrator for help.</p>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}
