{% extends "messaging/base.html" %}
{% block title %}Messaging{% endblock %}
{% load pagination %}

{% block content %}
<h1>
	<a href="">Messaging</a>
	/ <a href="">New Message</a>
</h1>{% if filters %}

<div class="split-4 filters">{% for filter in filters %}
	<div class="{% ifequal forloop.counter 1 %}left{% endifequal %}{% ifequal forloop.counter 2 %}mid-left{% endifequal %}{% ifequal forloop.counter 3 %}mid-right{% endifequal %}{% ifequal forloop.counter 4 %}right{% endifequal %}">
		<div class="module">
			<h2>{{ filter.title }}</h2>
			<ul>{% for item in filter.items %}
				<li id="{{ item.uid }}"{% if item.parent_uid %} class="child-of-{{ item.parent_uid }}"{% endif %}>
					<a href="">{{ item }}</a>
				</li>{% endfor %}
		</div>
	</div>{% endfor %}
</div>
<div class="clear-hack"></div>

<script type="text/javascript">
	(function() {
		var cls = "checked";
		var par = "-parent";

		var checked = function(element) {
			return $(element).hasClass(cls) || $(element).hasClass(cls+par);
		};

		var children = function(element) {
			var item_uid = $(element).get(0).id;
			return $(".filters li.child-of-" + item_uid);
		};

		var inherit = function(element, state) {
			$.each(children(element), function() {
				$(this).toggleClass(cls+par, state);
				inherit(this, checked(this));
			});
		};

		$(".filters a").click(function(ev) {
			var li = $(this).parent("li");
			li.toggleClass(cls);
			inherit(li, checked(li));
			ev.preventDefault();
		});
	})();
</script>{% endif %}

<div class="split-2">
	<div class="left">
		<div class="module recipients">
			<h2>Recipients</h2>

			<table class="sortable">
				<thead>
					<tr>
						<th><a href="">Person</a></th>
						<th><a href="">Role</a></th>
						<th><a href="">School</a></th>
					</tr>
				</thead>

				<tbody>{% if people.object_list %}{% for person in people.object_list %}
					<tr>
						<td>{{ person }}</td>
						<td>{{ person.school_role }}</td>
						<td>{{ person.location.name }}</td>
					</tr>{% endfor %}{% else %}
					<tr class="no-data">
						<td colspan="3">
							No recipients yet.
						</td>
					</tr>
					{% endif %}
				</tbody>

				<tfoot>
					<tr>
						<td colspan="3">
							<div class="paginator">
								{% paginator people %}
							</div>
						</td>
					</tr>
				</tfoot>
			</table>
		</div>
	</div>
	<div class="right">
		<div class="module contents">
			<h2>Message</h2>
			
			<div>
				<textarea cols="80" rows="5"></textarea>
				<input type="button" class="send" value="Send Messages" />
				<input type="button" class="cancel" value="Cancel" disabled="disabled" />
			</div>
		</div>
	</div>
</div>
<div class="clear-hack"></div>

<script type="text/javascript">
	(function() {
		$(".question a").click(function(ev) {
			var li = $(this).parent("li");
			li.toggleClass("checked");
			ev.preventDefault();
		});
	})();
</script>
{% endblock %}
